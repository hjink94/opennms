<blueprint xmlns="http://www.osgi.org/xmlns/blueprint/v1.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:cm="http://aries.apache.org/blueprint/xmlns/blueprint-cm/v1.1.0"
           xmlns:ext="http://aries.apache.org/blueprint/xmlns/blueprint-ext/v1.1.0"
           xsi:schemaLocation="
		http://www.osgi.org/xmlns/blueprint/v1.0.0
		http://www.osgi.org/xmlns/blueprint/v1.0.0/blueprint.xsd

		http://aries.apache.org/blueprint/xmlns/blueprint-cm/v1.1.0
		http://aries.apache.org/schemas/blueprint-cm/blueprint-cm-1.1.0.xsd

		http://aries.apache.org/blueprint/xmlns/blueprint-ext/v1.1.0
		http://aries.apache.org/schemas/blueprint-ext/blueprint-ext-1.1.xsd
">

    <!-- DAO -->
    <reference id="classificationRuleDao" interface="org.opennms.netmgt.flows.classification.persistence.api.ClassificationRuleDao" availability="mandatory"/>

    <!-- Rule Provicer -->
    <bean id="classificationRuleProvider" class="org.opennms.netmgt.flows.classification.internal.provider.DaoClassificationRuleProvider">
        <argument ref="classificationRuleDao"/>
    </bean>

    <!-- Classification Engine -->
    <bean id="useStaticRules" class="java.lang.System" factory-method="getProperty">
        <argument value="org.opennms.features.flows.classification.useStaticRules"/>
        <argument value="true"/>
    </bean>
    <bean id="defaultClassificationEngine" class="org.opennms.netmgt.flows.classification.internal.DefaultClassificationEngine">
        <argument ref="classificationRuleProvider" />
        <argument ref="useStaticRules"/>
    </bean>
    <bean id="cachingClassificationEngine" class="org.opennms.netmgt.flows.classification.internal.CachingClassificationEngine">
        <argument ref="defaultClassificationEngine" />
    </bean>
    <bean id="threadSafeClassificationEngine" class="org.opennms.netmgt.flows.classification.internal.ThreadSafeClassificationEngine">
        <argument ref="defaultClassificationEngine" />
    </bean>

    <!-- Expose Classification Engine -->
    <service interface="org.opennms.netmgt.flows.classification.ClassificationEngine" ref="threadSafeClassificationEngine"/>

    <service interface="org.opennms.netmgt.flows.classification.CsvRuleParser">
        <bean class="org.opennms.netmgt.flows.classification.internal.provider.CsvRuleParserImpl"/>
    </service>

</blueprint>
